<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="resizePageTitle">Công Cụ Thay Đổi Kích Thước Ảnh</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="css/resize.css"> <!-- Link đến file CSS riêng của resize -->
    <link rel="icon" href="favicon.png" type="image/png">
</head>

<body>
    <!-- Bộ chuyển đổi ngôn ngữ -->
    <div class="lang-switcher-container">
        <div class="lang-switcher btn-group">
            <button class="btn btn-outline-secondary lang-btn" data-lang="vi">VI</button>
            <button class="btn btn-outline-secondary lang-btn" data-lang="en">EN</button>
        </div>
    </div>

    <!-- ===== NAVBAR START (Custom CSS) ===== -->
    <nav class="custom-navbar">
        <div class="nav-container">
            <a class="nav-brand" href="index.html">
                <img style="max-height: 40px; display: inline-block; vertical-align: middle;" src="logo.png" alt="Logo">
            </a>
            <button class="nav-toggler" id="navbarToggler" aria-label="Toggle navigation">
                <span class="nav-toggler-icon"></span>
            </button>
            <div class="nav-collapse" id="navbarNavContent">
                <ul class="nav-menu">
                    <li class="nav-menu-item"><a class="nav-menu-link" href="index.html" data-translate="navHome">Trang Chủ</a></li>
                    <li class="nav-menu-item"><a class="nav-menu-link" href="game.html" data-translate="navPlayGame">Chơi Game</a></li>
                    <li class="nav-menu-item"><a class="nav-menu-link" href="about.html" data-translate="navAbout">Giới Thiệu</a></li>
                    <li class="nav-menu-item"><a class="nav-menu-link" href="contact.html" data-translate="navContact">Liên Hệ</a></li>
                    <li class="nav-menu-item active"><a class="nav-menu-link" href="resize.html" data-translate="navImageTools">Thay Đổi Kích Thước Ảnh</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- ===== NAVBAR END (Custom CSS) ===== -->
    <div style="padding-top: 80px;"></div>

    <div style="padding-top: 20px;" class="container">
        <!-- Tab lựa chọn công cụ (Tùy chọn, có thể bỏ nếu trang này chỉ làm resize) -->
        <ul class="nav nav-tabs mb-4" id="toolTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link" id="crop-square-tab" href="scale.html" role="tab" data-translate="toolSquareCropTitle">Cắt Ảnh Vuông</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="split-grid-tab" href="split.html" role="tab" data-translate="toolGridSplitTitle">Cắt Ảnh Lưới</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" id="resize-image-tab" href="resize.html" role="tab" data-translate="toolResizeTitle">Thay Đổi Kích Thước</a>
            </li>
        </ul>

        <h1 class="text-center mb-4" data-translate="resizePageTitle">Công Cụ Thay Đổi Kích Thước Ảnh</h1>
        <div class="alert alert-info" data-translate="resizeAlert">
            Chọn ảnh từ máy tính, nhập kích thước mong muốn (chiều rộng hoặc chiều cao). Chọn "Giữ tỷ lệ" để tự động
            điều chỉnh kích thước còn lại.
        </div>

        <!-- Khu vực Input -->
        <div class="row mb-4 align-items-end">
            <div class="col-md-12 form-group">
                <label for="image-input" data-translate="resizeSelectFile">Chọn file ảnh:</label>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="image-input"
                        accept="image/png, image/jpeg, image/gif, image/webp">
                    <label class="custom-file-label" for="image-input" data-browse="Duyệt" data-translate="resizeChooseFile">Chọn file...</label>
                </div>
            </div>
        </div>
        <div class="row mb-3 align-items-center">
            <div class="col-md-3 form-group">
                <label for="width-input" data-translate="resizeWidth">Chiều Rộng (px):</label>
                <input type="number" class="form-control" id="width-input" min="1" placeholder="VD: 800">
            </div>
            <div class="col-md-3 form-group">
                <label for="height-input" data-translate="resizeHeight">Chiều Cao (px):</label>
                <input type="number" class="form-control" id="height-input" min="1" placeholder="VD: 600">
            </div>
            <div class="col-md-3 form-group d-flex align-items-center pt-4">
                <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="aspect-ratio-lock" checked>
                    <label class="custom-control-label" for="aspect-ratio-lock" data-translate="resizeAspectRatio">Giữ tỷ lệ</label>
                </div>
            </div>
            <div class="col-md-3 form-group">
                <button id="resize-button" class="btn btn-warning btn-block" disabled data-translate="resizeButton">Thay Đổi Kích Thước</button>
            </div>
        </div>


        <!-- Khu vực xem trước ảnh gốc và ảnh đã resize -->
        <div class="row">
            <div class="col-md-6">
                <div class="preview-section">
                    <h5 data-translate="resizeOriginalImage">Ảnh Gốc</h5>
                    <span id="original-preview-placeholder" class="preview-placeholder" data-translate="resizeNoImage">Chưa có ảnh nào được chọn</span>
                    <img id="original-preview-image" src="#" alt="Ảnh gốc xem trước">
                    <p id="original-dimensions" class="mt-2 small text-muted"></p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="preview-section">
                    <h5 data-translate="resizeResizedImage">Ảnh Sau Khi Thay Đổi</h5>
                    <span id="resized-preview-placeholder" class="preview-placeholder" data-translate="resizeNoResult">Chưa có kết quả</span>
                    <img id="resized-preview-image" src="#" alt="Ảnh đã thay đổi kích thước xem trước">
                    <p id="resized-dimensions" class="mt-2 small text-muted"></p>
                </div>
            </div>
        </div>

        <!-- Khu vực hiển thị thông báo lỗi -->
        <div id="error-message" class="text-center mb-3"></div>

        <!-- Nút tải xuống -->
        <div class="row mt-3 mb-4">
            <div class="col-md-6 offset-md-3">
                <button id="download-button" class="btn btn-success btn-block" disabled data-translate="resizeDownloadButton">Tải Ảnh Đã Thay Đổi</button>
            </div>
        </div>

    </div>
    <div style="padding-bottom: 80px;"></div>
    <!-- ===== MAIN CONTENT END ===== -->

    <!-- ===== FOOTER START ===== -->
    <footer class="site-footer bg-dark text-white py-4">
        <div class="container-fluid">
            <div class="footer-content-wrapper">
                <div class="row">
                    <div class="col-md-3 mb-3 mb-md-0">
                        <img src="logo.png" alt="Logo" class="mb-2" style="max-height: 50px;">
                        <p class="small text-white-50" data-translate="footerUnlimited">Giải trí và sáng tạo không giới hạn.</p>
                    </div>
                    <div class="col-md-3 col-4 mb-3 mb-md-0">
                        <h5 class="fw-semibold" data-translate="footerExplore">Khám Phá</h5>
                        <ul class="list-unstyled">
                            <li><a href="index.html" class="text-white-50 text-decoration-none hover-light" data-translate="footerHome">Trang Chủ</a></li>
                            <li><a href="game.html" class="text-white-50 text-decoration-none hover-light" data-translate="footerJigsaw">Game Xếp Hình</a></li>
                        </ul>
                    </div>
                    <div class="col-md-3 col-4 mb-3 mb-md-0">
                        <h5 class="fw-semibold" data-translate="footerTools">Công cụ</h5>
                        <ul class="list-unstyled">
                            <li><a href="split.html" class="text-white-50 text-decoration-none hover-light" data-translate="footerGridSplit">Cắt Ảnh Lưới</a></li>
                            <li><a href="scale.html" class="text-white-50 text-decoration-none hover-light" data-translate="footerSquareCrop">Cắt Ảnh Vuông</a></li>
                            <li><a href="resize.html" class="text-white-50 text-decoration-none hover-light" data-translate="footerResize">Thay Đổi Kích Thước</a></li>
                        </ul>
                    </div>
                    <div class="col-md-3 col-4">
                        <h5 class="fw-semibold" data-translate="footerInfo">Thông Tin</h5>
                        <ul class="list-unstyled">
                            <li><a href="about.html" class="text-white-50 text-decoration-none hover-light" data-translate="footerAbout">Giới Thiệu</a></li>
                            <li><a href="contact.html" class="text-white-50 text-decoration-none hover-light" data-translate="footerContact">Liên Hệ</a></li>
                            <li><a href="terms.html" class="text-white-50 text-decoration-none hover-light" data-translate="footerTerms">Điều Khoản</a></li>
                        </ul>
                    </div>
                </div>
                <hr class="my-3 border-secondary">
                <div class="row">
                    <div class="col-12 text-center">
                        <p class="small text-white-50 mb-0" data-translate="footerCopyright">
                            © <span id="currentYear"></span> Game & Ảnh Pro. Phát triển bởi Trần Hữu Đạt. Bảo lưu mọi quyền.
                        </p>
                        <p class="small text-white-50" data-translate="footerBuiltWith">
                            <small>Xây dựng với <i class="fas fa-heart text-danger"></i> và Bootstrap, jQuery.</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- ===== FOOTER END ===== -->

    <!-- jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    
    <script src="js/translations.js"></script>
    <script src="js/setLanguage.js"></script>
    <script src="js/i18n.js"></script>

    <!-- Custom JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const imageInput = document.getElementById('image-input');
            const originalPreviewImage = document.getElementById('original-preview-image');
            const originalPreviewPlaceholder = document.getElementById('original-preview-placeholder');
            const originalDimensionsP = document.getElementById('original-dimensions');

            const resizedPreviewImage = document.getElementById('resized-preview-image');
            const resizedPreviewPlaceholder = document.getElementById('resized-preview-placeholder');
            const resizedDimensionsP = document.getElementById('resized-dimensions');

            const widthInput = document.getElementById('width-input');
            const heightInput = document.getElementById('height-input');
            const aspectRatioLock = document.getElementById('aspect-ratio-lock');
            const resizeButton = document.getElementById('resize-button');
            const downloadButton = document.getElementById('download-button');
            const errorMessage = document.getElementById('error-message');
            const fileLabel = document.querySelector('.custom-file-label');

            let originalImage = null; // Đối tượng Image gốc
            let originalFileName = 'image'; // Tên file gốc
            let originalAspectRatio = 0;
            let resizedImageDataUrl = null; // Data URL của ảnh đã resize

            // --- Xử lý chọn file ---
            imageInput.addEventListener('change', function (e) {
                resetUI();
                const file = e.target.files[0];
                if (!file) {
                    return;
                }

                if (!file.type.startsWith('image/')) {
                    showError('Vui lòng chọn một file ảnh hợp lệ (png, jpg, gif, webp).');
                    imageInput.value = ''; // Reset input file
                    fileLabel.textContent = 'Chọn file...';
                    return;
                }

                originalFileName = file.name.split('.').slice(0, -1).join('.') || 'image';
                fileLabel.textContent = file.name;

                const reader = new FileReader();
                reader.onload = function (event) {
                    originalPreviewImage.src = event.target.result;
                    originalPreviewImage.style.display = 'block';
                    originalPreviewPlaceholder.style.display = 'none';

                    originalImage = new Image();
                    originalImage.onload = () => {
                        originalAspectRatio = originalImage.naturalWidth / originalImage.naturalHeight;
                        widthInput.value = originalImage.naturalWidth;
                        heightInput.value = originalImage.naturalHeight;
                        originalDimensionsP.textContent = `Kích thước gốc: ${originalImage.naturalWidth}x${originalImage.naturalHeight}px`;
                        resizeButton.disabled = false;
                    };
                    originalImage.onerror = () => {
                        showError('Không thể tải ảnh để xử lý.');
                        originalImage = null;
                    };
                    originalImage.src = event.target.result;
                }
                reader.readAsDataURL(file);
            });

            // --- Xử lý thay đổi kích thước khi nhập ---
            widthInput.addEventListener('input', function () {
                if (aspectRatioLock.checked && originalImage && originalAspectRatio) {
                    const newWidth = parseInt(this.value);
                    if (newWidth > 0) {
                        heightInput.value = Math.round(newWidth / originalAspectRatio);
                    }
                }
            });

            heightInput.addEventListener('input', function () {
                if (aspectRatioLock.checked && originalImage && originalAspectRatio) {
                    const newHeight = parseInt(this.value);
                    if (newHeight > 0) {
                        widthInput.value = Math.round(newHeight * originalAspectRatio);
                    }
                }
            });

            aspectRatioLock.addEventListener('change', function () {
                // Khi thay đổi checkbox, nếu đang giữ tỷ lệ, cập nhật lại 1 chiều dựa trên chiều kia
                if (this.checked && originalImage && originalAspectRatio) {
                    const currentWidth = parseInt(widthInput.value);
                    if (currentWidth > 0) {
                        heightInput.value = Math.round(currentWidth / originalAspectRatio);
                    } else {
                        const currentHeight = parseInt(heightInput.value);
                        if (currentHeight > 0) {
                            widthInput.value = Math.round(currentHeight * originalAspectRatio);
                        }
                    }
                }
            });


            // --- Xử lý nhấn nút Thay Đổi Kích Thước ---
            resizeButton.addEventListener('click', function () {
                errorMessage.textContent = '';
                resizedPreviewImage.style.display = 'none';
                resizedPreviewPlaceholder.textContent = 'Đang xử lý...';
                resizedPreviewPlaceholder.style.display = 'block';
                resizedDimensionsP.textContent = '';
                downloadButton.disabled = true;
                resizedImageDataUrl = null;

                if (!originalImage || !originalImage.complete || originalImage.naturalWidth === 0) {
                    showError('Ảnh chưa được tải hoặc không hợp lệ. Vui lòng chọn lại ảnh.');
                    return;
                }

                const targetWidth = parseInt(widthInput.value);
                const targetHeight = parseInt(heightInput.value);

                if (isNaN(targetWidth) || isNaN(targetHeight) || targetWidth < 1 || targetHeight < 1) {
                    showError('Chiều rộng và chiều cao phải là số nguyên dương.');
                    resizedPreviewPlaceholder.textContent = 'Chưa có kết quả';
                    return;
                }

                // Tạo canvas để vẽ ảnh đã resize
                const canvas = document.createElement('canvas');
                canvas.width = targetWidth;
                canvas.height = targetHeight;
                const ctx = canvas.getContext('2d');

                try {
                    // Vẽ ảnh gốc lên canvas với kích thước mới
                    ctx.drawImage(originalImage, 0, 0, targetWidth, targetHeight);

                    resizedImageDataUrl = canvas.toDataURL('image/png'); // Hoặc 'image/jpeg' tùy thuộc vào file gốc
                    resizedPreviewImage.src = resizedImageDataUrl;
                    resizedPreviewImage.style.display = 'block';
                    resizedPreviewPlaceholder.style.display = 'none';
                    resizedDimensionsP.textContent = `Kích thước mới: ${targetWidth}x${targetHeight}px`;
                    downloadButton.disabled = false;

                } catch (error) {
                    console.error('Lỗi khi thay đổi kích thước ảnh:', error);
                    showError('Có lỗi xảy ra khi thay đổi kích thước ảnh.');
                    resizedPreviewPlaceholder.textContent = 'Lỗi xử lý';
                }
            });

            // --- Xử lý nhấn nút Tải Ảnh ---
            downloadButton.addEventListener('click', function () {
                if (!resizedImageDataUrl) {
                    showError('Không có ảnh đã thay đổi kích thước để tải xuống.');
                    return;
                }
                const link = document.createElement('a');
                // Cố gắng giữ phần mở rộng file gốc nếu có thể, hoặc mặc định là png
                const originalExtension = (originalImage.src.match(/\.(jpeg|jpg|gif|png|webp)$/i) || [, "png"])[1];
                link.download = `${originalFileName}_resized.${originalExtension}`;
                link.href = resizedImageDataUrl;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });


            // --- Hàm hiển thị lỗi ---
            function showError(message) {
                errorMessage.textContent = message;
                console.error("Lỗi:", message);
            }

            // --- Hàm reset UI ---
            function resetUI() {
                errorMessage.textContent = '';
                originalPreviewImage.src = '#';
                originalPreviewImage.style.display = 'none';
                originalPreviewPlaceholder.textContent = 'Chưa có ảnh nào được chọn';
                originalPreviewPlaceholder.style.display = 'block';
                originalDimensionsP.textContent = '';

                resizedPreviewImage.src = '#';
                resizedPreviewImage.style.display = 'none';
                resizedPreviewPlaceholder.textContent = 'Chưa có kết quả';
                resizedPreviewPlaceholder.style.display = 'block';
                resizedDimensionsP.textContent = '';

                widthInput.value = '';
                heightInput.value = '';
                // aspectRatioLock.checked = true; // Giữ nguyên trạng thái checkbox

                resizeButton.disabled = true;
                downloadButton.disabled = true;
                originalImage = null;
                originalAspectRatio = 0;
                resizedImageDataUrl = null;
                // fileLabel.textContent = 'Chọn file...'; // Không reset tên file ở đây để người dùng biết file nào đang chọn
            }


            // Cập nhật label của input file khi chọn file (cho Bootstrap)
            imageInput.addEventListener('change', function () {
                let fileName = this.value.split('\\').pop();
                this.nextElementSibling.classList.add("selected");
                this.nextElementSibling.innerHTML = fileName || 'Chọn file...';
            });

            // Navbar toggler for custom navbar
            document.getElementById('navbarToggler').addEventListener('click', function () {
                document.getElementById('navbarNavContent').classList.toggle('show');
            });

            // Cập nhật năm hiện tại ở footer
            document.getElementById('currentYear').textContent = new Date().getFullYear();

        });
    </script>

</body>

</html>